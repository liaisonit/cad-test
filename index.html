<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAD Readiness Test</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* Applying Montserrat as the default font */
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f3f4f6; /* light gray */
        }

        /* --- Content Protection --- */
        .no-select {
            -webkit-user-select: none; /* Safari */
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */
        }
        
        /* Custom Styles based on requirements */
        .primary-accent-bg { background-color: #7A2532; }
        .primary-accent-text { color: #7A2532; }
        .primary-accent-border { border-color: #7A2532; }
        
        /* Typography - Reduced font sizes */
        h1 { font-size: 16px; font-weight: 700; } /* bold */
        h2 { font-size: 14px; font-weight: 300; } /* light */
        p, .answer-option, .form-input, .form-select { font-size: 13px; font-weight: 300; } /* light */
        .note-text { font-size: 11px; font-weight: 300; font-style: italic; } /* light, italic */
        .question-text { font-weight: 700; } /* bold */

        /* Instruction list styling */
        .instruction-list li {
            font-size: 12px;
            line-height: 1.7; /* Approx 30% increase */
        }
        @media (max-width: 640px) {
            .instruction-list li {
                font-size: 11px;
            }
        }

        /* Input field focus highlight */
        .form-input:focus, .form-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(122, 37, 50, 0.4);
            border-color: #7A2532;
        }
        
        /* Custom progress bar transition */
        .progress-bar-inner {
            transition: width 0.5s ease-in-out;
        }

        /* Fixed height for quiz container to prevent layout shifts */
        #quiz-container {
            min-height: 450px;
        }

        /* Styling for the answer options */
        .answer-option {
            border: 2px solid transparent;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }
        
        .answer-option.selected {
            border-color: #7A2532;
            background-color: rgba(122, 37, 50, 0.05);
        }
        
        /* Ensure the main container can scroll if content overflows on small screens */
        #app-container {
            height: 100vh;
            overflow-y: auto;
        }

        /* Animation for fading steps in and out */
        .step-transition {
            transition: opacity 0.3s ease-in-out;
        }

        .fade-out {
            opacity: 0;
        }
        .fade-in {
            opacity: 1;
        }

        /* Simple spinner for loading state */
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #7A2532;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white no-select">

    <div id="app-container" class="w-full bg-white">
        <div class="p-6 md:p-8 max-w-4xl mx-auto w-full flex flex-col justify-center min-h-full">
            <!-- Header -->
            <div class="text-center mb-6">
                <h1 class="text-lg md:text-xl font-bold primary-accent-text">CAD Readiness Test</h1>
                <p class="text-gray-500 mt-1 text-sm">An advanced assessment for final-year students.</p>
            </div>

            <!-- Progress Bar -->
            <div id="progress-bar-container" class="w-full bg-gray-200 rounded-full h-2.5 mb-6 hidden">
                <div id="progress-bar" class="primary-accent-bg h-2.5 rounded-full progress-bar-inner" style="width: 0%"></div>
            </div>

            <!-- Step 1: User Info -->
            <div id="step1" class="step-transition fade-in">
                <div class="text-center mb-6">
                    <h1 class="text-gray-800">Tell us about you</h1>
                    <h2 class="text-gray-600">Enter your details to begin the assessment.</h2>
                </div>
                <div class="space-y-4 mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="fullName" placeholder="Full Name" class="form-input w-full p-3 h-12 bg-gray-100 rounded-lg border-2 border-transparent">
                        <input type="email" id="email" placeholder="Email Address" class="form-input w-full p-3 h-12 bg-gray-100 rounded-lg border-2 border-transparent">
                        <input type="tel" id="phone" placeholder="Phone Number" class="form-input w-full p-3 h-12 bg-gray-100 rounded-lg border-2 border-transparent">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="collegeName" placeholder="College Name" class="form-input w-full p-3 h-12 bg-gray-100 rounded-lg border-2 border-transparent">
                        <select id="semester" class="form-select w-full p-3 h-12 bg-gray-100 rounded-lg border-2 border-transparent text-gray-500 appearance-none">
                            <option value="" disabled selected>Select Semester</option>
                            <option value="1st-2nd">1st-2nd</option>
                            <option value="3rd-4th">3rd-4th</option>
                            <option value="5th-6th">5th-6th</option>
                            <option value="7th-8th">7th-8th</option>
                            <option value="Masters">Masters</option>
                        </select>
                        <select id="stream" class="form-select w-full p-3 h-12 bg-gray-100 rounded-lg border-2 border-transparent text-gray-500 appearance-none">
                            <option value="" disabled selected>Select Stream</option>
                            <option value="Civil">Civil</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Architectural">Architectural</option>
                            <option value="Electrical">Electrical</option>
                            <option value="Industrial Design">Industrial Design</option>
                            <option value="Interior Design">Interior Design</option>
                        </select>
                    </div>
                </div>
                <div class="bg-red-50 p-4 rounded-lg text-center mb-6">
                    <p class="note-text text-red-800"><span class="font-bold">Please Note:</span> This information will be used for your certificate and to contact you for placement opportunities. Ensure all details are accurate. A score above 85% makes you eligible.</p>
                </div>
                <div class="text-center flex items-center justify-center space-x-4">
                    <button id="show-instructions-btn" class="primary-accent-bg text-white font-bold py-3 px-8 rounded-lg shadow-md hover:opacity-90 transition-opacity flex items-center justify-center">
                        Next
                    </button>
                    <button id="open-validator-btn" class="p-3 bg-gray-200 rounded-full shadow-md hover:bg-gray-300 transition-colors" title="Validate Certificate">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-patch-check-fill text-gray-700" viewBox="0 0 16 16">
                            <path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"/>
                        </svg>
                    </button>
                </div>
                 <div id="error-container" class="text-center mt-4 hidden">
                    <p id="error-message" class="text-red-500 font-bold"></p>
                 </div>
            </div>

            <!-- NEW Step: Instructions -->
            <div id="step-instructions" class="hidden step-transition">
                <div class="text-center mb-6">
                    <h1 class="text-gray-800">Test Instructions</h1>
                    <h2 class="text-gray-600">Please read the following carefully before you begin.</h2>
                </div>
                <div class="text-left max-w-2xl mx-auto bg-gray-50 p-6 rounded-lg">
                    <ol class="list-decimal list-inside space-y-3 instruction-list">
                        <li>This test consists of 15 questions randomly selected from a large bank. All questions are new for each attempt.</li>
                        <li>You will have <b>40 seconds</b> to answer each question. If the timer runs out, the test will automatically move to the next question.</li>
                        <li>The questions are designed to test your fundamental and practical understanding of industrial CAD applications.</li>
                        <li>Upon completion, you will be awarded a personalized, downloadable certificate with your score.</li>
                        <li>A full review of your answers, along with the correct answers, will be displayed at the end of the test.</li>
                        <li>You can validate any certificate using the validation button (<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-patch-check-fill inline-block" viewBox="0 0 16 16"><path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"/></svg>) on the home screen.</li>
                        <li>There is <b>no negative marking</b>, so we encourage you to attempt every question.</li>
                        <li>Please ensure you have a stable internet connection for a smooth and uninterrupted test experience.</li>
                        <li>This is an assessment of your individual skill. Please answer honestly and without any external help. Good luck!</li>
                    </ol>
                </div>
                 <div class="text-center mt-8">
                    <button id="start-quiz-btn" class="primary-accent-bg text-white font-bold py-3 px-8 rounded-lg shadow-md hover:opacity-90 transition-opacity flex items-center justify-center mx-auto">
                        Begin Test
                    </button>
                </div>
            </div>

            <!-- Step 2: The Quiz -->
            <div id="step2" class="hidden step-transition">
                 <div id="quiz-container" class="flex flex-col justify-between">
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-gray-600">Question <span id="question-number">1</span>/15</h2>
                            <div id="timer" class="primary-accent-text font-bold text-lg">00:40</div>
                        </div>
                        <p id="question-text" class="question-text text-base md:text-lg text-gray-900 mb-6">Question text goes here...</p>
                        <div id="answer-options" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            </div>
                    </div>
                    <div class="text-center mt-8">
                        <button id="next-question-btn" class="primary-accent-bg text-white font-bold py-3 px-12 rounded-lg shadow-md hover:opacity-90 transition-opacity">Next</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Results -->
            <div id="step3" class="hidden step-transition text-center">
                <h1 class="text-gray-800">Test Complete!</h1>
                <h2 class="text-gray-600 mb-4">Here is your result.</h2>
                <div class="my-8">
                    <p class="text-gray-700 text-lg">You Scored:</p>
                    <p id="final-score" class="text-5xl font-bold primary-accent-text">12/15</p>
                </div>
                <p id="placement-message" class="text-lg font-semibold mb-6"></p>
                <button id="download-cert-btn" class="primary-accent-bg text-white font-bold py-3 px-8 rounded-lg shadow-md hover:opacity-90 transition-opacity">Download Certificate</button>
                
                <hr class="my-8">

                <!-- Full Quiz Review -->
                <div id="review-section" class="hidden mt-8 text-left">
                    <h1 class="text-gray-800 text-center">Full Quiz Review</h1>
                    <h2 class="text-gray-600 text-center mb-4">Review your answers below.</h2>
                    <div id="full-review-list" class="space-y-6"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Certificate Validator Modal -->
    <div id="validator-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md text-center">
            <h1 class="text-gray-800 mb-2">Validate Certificate</h1>
            <p class="text-gray-600 text-sm mb-4">Enter the certificate number to verify its authenticity.</p>
            <input type="text" id="cert-id-input" placeholder="Enter Certificate Number (e.g., CAD-123...)" class="form-input w-full p-3 bg-gray-100 rounded-lg border-2 border-transparent mb-4">
            <div id="validator-result" class="text-left hidden p-4 rounded-lg"></div>
            <div class="flex items-center justify-center space-x-4">
                <button id="validate-cert-btn" class="primary-accent-bg text-white font-bold py-2 px-6 rounded-lg shadow-md hover:opacity-90 flex items-center justify-center">Validate</button>
                <button id="close-validator-btn" class="bg-gray-300 text-gray-800 font-bold py-2 px-6 rounded-lg shadow-md hover:bg-gray-400">Close</button>
            </div>
        </div>
    </div>

    <!-- Certificate Template (Hidden) -->
    <div id="certificate-template" class="hidden absolute -left-full">
        <div style="width: 800px; height: 565px; border: 10px solid #7A2532; padding: 20px; background-color: white; font-family: 'Montserrat', sans-serif; position: relative; box-sizing: border-box;">
            <div style="border: 2px solid #7A2532; width: 100%; height: 100%; text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; box-sizing: border-box;">
                 <h1 style="font-size: 42px; color: #7A2532; font-weight: bold; margin: 0;">Certificate of Achievement</h1>
                 <p style="font-size: 20px; margin-top: 24px; font-weight: 300;">This certificate is proudly presented to</p>
                 <p id="cert-name" style="font-size: 36px; font-weight: bold; color: #333; margin: 20px 0; border-bottom: 2px solid #333; padding-bottom: 8px;">User Name</p>
                 <p style="font-size: 20px; font-weight: 300; margin-top: 16px;">for successfully completing the</p>
                 <p style="font-size: 24px; font-weight: bold; color: #7A2532; margin-top: 8px;">CAD Readiness Test</p>
                 <p style="font-size: 20px; font-weight: 300; margin-top: 16px;">with a score of</p>
                 <p id="cert-score" style="font-size: 28px; font-weight: bold; color: #333; margin-top: 8px;">15/15</p>
                 <p style="font-size: 14px; font-weight: 300; margin-top: 30px;">Date of Completion: <span id="cert-date">DD/MM/YYYY</span></p>
                 <p id="cert-number" style="font-size: 10px; color: #777; position: absolute; bottom: 15px; left: 0; right: 0; text-align: center;">Certificate No: ABC-123</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const googleSheetWebAppUrl = 'https://script.google.com/macros/s/AKfycbxgeKIfau_v4JIxHP0rVaoWwpMsI2HKNvXD1MwkyYgY1qlvRUTM1sYSux5_GWfVjQMuqw/exec';

            // --- DOM ELEMENTS ---
            const progressBarContainer = document.getElementById('progress-bar-container');
            const progressBar = document.getElementById('progress-bar');
            const step1 = document.getElementById('step1');
            const stepInstructions = document.getElementById('step-instructions');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const quizContainer = document.getElementById('quiz-container');
            const showInstructionsBtn = document.getElementById('show-instructions-btn');
            const startQuizBtn = document.getElementById('start-quiz-btn');
            const nextQuestionBtn = document.getElementById('next-question-btn');
            const downloadCertBtn = document.getElementById('download-cert-btn');
            const fullNameInput = document.getElementById('fullName');
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const collegeNameInput = document.getElementById('collegeName');
            const semesterInput = document.getElementById('semester');
            const streamInput = document.getElementById('stream');
            const errorContainer = document.getElementById('error-container');
            const errorMessageEl = document.getElementById('error-message');
            const questionNumberEl = document.getElementById('question-number');
            const questionTextEl = document.getElementById('question-text');
            const answerOptionsEl = document.getElementById('answer-options');
            const timerEl = document.getElementById('timer');
            const finalScoreEl = document.getElementById('final-score');
            const placementMessageEl = document.getElementById('placement-message');
            const reviewSection = document.getElementById('review-section');
            const fullReviewList = document.getElementById('full-review-list');
            const openValidatorBtn = document.getElementById('open-validator-btn');
            const validatorModal = document.getElementById('validator-modal');
            const closeValidatorBtn = document.getElementById('close-validator-btn');
            const validateCertBtn = document.getElementById('validate-cert-btn');
            const certIdInput = document.getElementById('cert-id-input');
            const validatorResultEl = document.getElementById('validator-result');

            // --- QUIZ DATA & STATE ---
            let quizQuestions = [];
            const questionBank = [
                 // 55+ Industry-focused and fundamental CAD questions
                // --- Fundamental Questions (Approx 30%) ---
                { question: "In 3D modeling, what is the primary function of the 'Extrude' command?", options: ["To create a hole through a part.", "To add material by projecting a 2D sketch along a straight line.", "To create a rounded edge on a corner.", "To revolve a sketch around an axis."], answer: 1 },
                { question: "What is the main purpose of a 'Fillet' feature?", options: ["To create a sharp, angled corner.", "To create a rounded internal or external corner on a part.", "To remove material from a solid body.", "To create a threaded hole."], answer: 1 },
                { question: "In a CAD assembly, what does a 'Concentric' mate do?", options: ["It makes two flat faces touch.", "It aligns the center axes of two cylindrical, conical, or circular features.", "It makes two parts parallel to each other.", "It fixes a component at a specific distance from another."], answer: 1 },
                { question: "What does the acronym 'DFM' stand for in the context of engineering?", options: ["Design for Marketing", "Data File Management", "Design for Manufacturing", "Dynamic Force Modeling"], answer: 2 },
                { question: "Which of the following best describes 'Bottom-Up' assembly modeling?", options: ["All parts are designed within a single master file.", "The assembly layout is designed first, then parts are built from it.", "Individual parts are created separately and then inserted and constrained together in an assembly file.", "The assembly is built using only library components."], answer: 2 },
                { question: "Which feature is used to create a solid model by revolving a 2D profile around a central axis?", options: ["Extrude", "Sweep", "Loft", "Revolve"], answer: 3 },
                { question: "What does 'associativity' between a 3D model and its 2D drawing mean in a professional CAD system?", options: ["The drawing and model files are stored in the same folder.", "The drawing is a static picture of the model at one point in time.", "Changes made to the 3D model automatically update all the views and dimensions on the 2D drawing.", "The drawing can be opened on any computer that has the model file."], answer: 2 },
                { question: "What is a key difference between a 'Fillet' and a 'Chamfer'?", options: ["Fillets are always larger than chamfers.", "A fillet creates a rounded edge; a chamfer creates an angled or beveled edge.", "Only fillets can be applied to internal edges.", "Chamfers are used for sheet metal, fillets are not."], answer: 1 },
                { question: "When creating an assembly, what is the best practice for the very first component you insert?", options: ["Leave it free to move anywhere.", "Mate it to the second component you insert.", "Fix it in space, typically by aligning its origin with the assembly's origin.", "Immediately hide it."], answer: 2 },
                { question: "What is a 'fully defined' or 'fully constrained' sketch?", options: ["A sketch where all lines are black, meaning its shape and size are locked and cannot change unintentionally.", "A sketch that has been approved by a manager.", "A sketch that contains no curves, only straight lines.", "A sketch that has been extruded into a 3D feature."], answer: 0 },
                { question: "What is the purpose of a 'Shell' command?", options: ["To create a solid sphere.", "To hollow out a solid body, leaving a thin wall of a specified thickness.", "To add a protective coating to a part.", "To create an assembly from multiple parts."], answer: 1 },
                { question: "What is the function of a 'mirror' feature in CAD?", options: ["To create a reflective surface finish.", "To create a symmetrical copy of features or bodies across a specified plane.", "To flip the entire assembly upside down.", "To analyze the optical properties of a part."], answer: 1 },
                { question: "The main purpose of a 'Bill of Materials' (BOM) generated from a CAD assembly is to:", options: ["Provide a visual rendering of the product.", "List all the components, their quantities, and other relevant information required for purchasing and manufacturing.", "Calculate the total weight of the assembly.", "Serve as an instruction manual for the end-user."], answer: 1 },
                { question: "When creating a 'sweep' feature, what are the two essential inputs required?", options: ["A start point and an end point.", "A profile sketch and a path sketch.", "A material and a thickness.", "An axis of revolution and an angle."], answer: 1 },
                { question: "A 'tangency' constraint between a line and an arc in a 2D sketch ensures what?", options: ["The line and the arc have the same length.", "The line touches the arc at a single point and shares the same slope at that point.", "The line passes through the center point of the arc.", "The line and the arc are parallel to each other."], answer: 1 },
                { question: "Which of the following is a primary benefit of using a Product Data Management (PDM) system in a team environment?", options: ["It automatically performs FEA on all parts.", "It provides version control, prevents accidental overwrites, and manages the single source of truth for all design data.", "It guarantees all designs are 100% error-free.", "It allows multiple users to edit the same file at the exact same time."], answer: 1 },
                { question: "What does 'meshing' in FEA refer to?", options: ["The process of applying loads and constraints.", "The process of interpreting results.", "The process of breaking down a complex CAD model into a large number of smaller, simpler shapes (elements).", "The process of selecting a material for the analysis."], answer: 2 },

                // --- Advanced & Industry Questions (Approx 70%) ---
                { question: "A cast iron housing requires a mounting face to be flat within 0.05mm and parallel to the primary datum plane 'A' within 0.1mm. Which GD&T callout correctly controls this?", options: ["Only a flatness callout of 0.05.", "Only a parallelism callout of 0.1.", "A parallelism callout of 0.1, which also implicitly controls flatness to 0.1.", "A flatness callout of 0.05, and a separate parallelism callout of 0.1."], answer: 3 },
                { question: "To ensure a smooth, flowing highlight line (G2 continuity) across a seam on a car fender, a surface modeler should prioritize what?", options: ["Matching the number of isoparms on both surfaces.", "Ensuring the tangent magnitudes are equal at the boundary.", "Aligning the control points of both surfaces into a single, smooth curve.", "Ensuring the curvature of both surfaces is identical at every point along their shared boundary."], answer: 3 },
                { question: "An FEA of a welded bracket shows a stress hotspot at the toe of the weld that exceeds the material's yield strength. What is the most likely reason and appropriate next step for an analyst?", options: ["The weld material is too weak; specify a stronger filler.", "This is a stress singularity due to the sharp geometric corner; evaluate the mesh-insensitive structural stress or add a realistic weld bead profile.", "The global mesh is too coarse; refine the entire model mesh by 50% and re-run.", "The applied load is incorrect; reduce it until the stress is below yield."], answer: 1 },
                { question: "In a PDM system, your team is moving from a prototype to a production design. This milestone is best captured by:", options: ["Creating a new version of every part in the assembly.", "Performing a 'Baseline' or 'Promotion' of the assembly to a 'Released' lifecycle state.", "Checking out all files and then checking them back in.", "Saving all the files in a new, separate folder on the server."], answer: 1 },
                { question: "When designing a plastic part for injection molding, why is maintaining a uniform wall thickness a critical DFM principle?", options: ["It makes the CAD model easier to build.", "It minimizes the risk of sink marks, warping, and uneven cooling, ensuring part quality and dimensional stability.", "It reduces the overall weight of the part.", "It allows for the use of cheaper plastic materials."], answer: 1 },
                { question: "A designer creates a complex assembly using a 'Bottom-Up' approach. What is a major disadvantage of this method when a fundamental change is required for the overall product layout?", options: ["The file sizes are larger than in a 'Top-Down' approach.", "It's impossible to create a Bill of Materials (BOM).", "Changes may require manually editing dozens of individual parts and their mates, as there is no central design driver.", "The assembly cannot be used for a motion analysis."], answer: 2 },
                { question: "What fundamental concept does a 'Profile of a Surface' tolerance control when applied with datum references?", options: ["It controls only the flatness or cylindricity of the surface.", "It defines a 3D tolerance boundary around the true, ideal surface, controlling its form, orientation, and location simultaneously.", "It controls the surface finish (roughness) of the part.", "It is only used for controlling the edge of a part."], answer: 1 },
                { question: "You are creating a parametric model of a gear. To ensure robust updates, the number of teeth should be driven by a formula based on the gear's pitch and diameter. Where should this controlling formula ideally be defined?", options: ["In a text note on the 2D drawing.", "In the file name of the part.", "In the main 'Equations' or 'Parameters' manager of the CAD software.", "In the description field of the part's properties."], answer: 2 },
                { question: "A hole is dimensioned as Ø20 ±0.1. Its position is controlled by a GD&T callout |POS|Ø0.05(M)|A|B|C|. If the manufactured hole measures Ø19.9mm (its MMC), what is the total diameter of its cylindrical positional tolerance zone?", options: ["0.05 mm", "0.15 mm", "0.1 mm", "0.25 mm"], answer: 0 },
                { question: "What is the primary reason for using a 'skeleton' part in a top-down assembly design for a welded frame?", options: ["To visually represent the final frame for marketing images.", "The skeleton's 3D sketch contains the master layout, and all individual tube members are created relative to it, ensuring the entire frame updates if the layout changes.", "To perform a weight calculation of the final assembly.", "To test the strength of the welds using FEA."], answer: 1 },
                { question: "In sheet metal design, what is a 'bend deduction' used for?", options: ["To calculate the final weight of the part.", "To subtract material from the flat pattern length to account for the stretching and compressing of material in a bend.", "To determine the minimum allowable bend radius.", "To specify a decorative cutout in the bend area."], answer: 1 },
                { question: "Why is it generally bad practice in parametric modeling to create sketch relations to the edges of generated features (like fillets or chamfers)?", options: ["It is not possible in most CAD systems.", "It creates unstable models, as the fillet's edge may be deleted or change identity if the parent geometry is modified, causing sketch failures.", "It significantly increases file size.", "It makes the model incompatible with PDM systems."], answer: 1 },
                { question: "A motion analysis of a packaging machine reveals a high acceleration 'spike' on a critical component. In the real world, this would likely cause:", options: ["A gradual increase in temperature.", "A loud, high-pitched noise and significant vibratory forces, potentially leading to premature failure.", "The component to become more efficient.", "A reduction in the machine's power consumption."], answer: 1 },
                { question: "The 'projected tolerance zone' modifier is critically important for which application?", options: ["Controlling the location of a shallow counterbore.", "Ensuring the orientation of a tapped hole is controlled over the full engagement depth of its mating stud or bolt.", "Controlling the flatness of a large surface plate.", "Specifying the color of a painted surface."], answer: 1 },
                { question: "A 'circular dependency' or 'rebuild error' in a feature-based CAD model typically means:", options: ["The computer's memory is full.", "A feature (e.g., Sketch-B) is dependent on another feature (e.g., Cut-A), which in turn is dependent on the first feature (Sketch-B), creating an unsolvable logic loop.", "The file has been corrupted and must be restored from a backup.", "The wrong material has been assigned to the part."], answer: 1 },
                { question: "To create a complex, ergonomic handle with smooth, flowing shapes, which modeling technique is most suitable?", options: ["Creating a series of rectangular blocks and joining them.", "Using primarily sketch-based features like extrudes and revolves.", "Surface modeling, using features like lofts, boundaries, and sweeps to create complex curvature.", "Directly editing the mesh of a simple solid part."], answer: 2 },
                { question: "An FEA result shows a maximum stress of 200 MPa. The material's yield strength is 250 MPa. What is the Factor of Safety (FOS)?", options: ["0.8", "1.25", "50", "200"], answer: 1 },
                { question: "In a tolerance stack-up, if all dimensions are bilateral (e.g., ±0.1), the 'Worst-Case' result is calculated by:", options: ["Taking the square root of the sum of the squares (RSS) of the tolerances.", "Averaging all the tolerance values.", "Simply summing all the tolerance values.", "Multiplying all the tolerance values together."], answer: 2 },
                { question: "A 'multi-body part' file is most useful for which design scenario?", options: ["Creating a simple, single component like a bolt.", "Designing a weldment or a master model where multiple, separate solid bodies need to be managed and interact within a single file.", "Creating a detailed assembly drawing.", "Running a thermal analysis."], answer: 1 },
                { question: "What is the purpose of 'Isoparms' or 'UV curves' on a NURBS surface?", options: ["They represent the toolpaths for machining the surface.", "They are a visual representation of the underlying mathematical grid defining the surface's shape.", "They indicate the direction of material grain.", "They are only used for applying textures and decals."], answer: 1 },
                { question: "What is the main reason to use a 'Limit' mate in an assembly?", options: ["To fix a component completely in space.", "To allow a component to move within a defined range of motion (e.g., an angle or distance).", "To create a permanent bond between two components.", "To align the centers of two cylindrical faces."], answer: 1 },
                { question: "What does a 'B-Rep' representation in a CAD kernel define a solid by?", options: ["Its procedural feature history.", "A polygonal mesh of triangles.", "Its bounding surfaces, edges, and vertices.", "A cloud of points in 3D space."], answer: 2 },
                { question: "To create a smooth transition between two surfaces of different shapes, like a square profile blending into a circular profile, which feature is most appropriate?", options: ["Extrude", "Revolve", "Loft", "Sweep"], answer: 2 },
                { question: "In a CAM context, what does 'post-processing' refer to?", options: ["Cleaning the part after it has been machined.", "The final simulation of the toolpath.", "Translating the generic cutter location data (CLDATA) from the CAM software into the specific G-code language required by a particular CNC machine.", "Applying a surface finish to the CAD model."], answer: 2 },
                { question: "A hole is defined by |POS|Ø0.2|A(M)|B|C|. Datum feature A is a pin with a size of Ø10 ±0.1. If the actual manufactured datum pin measures Ø9.9 (its LMC), how much 'datum shift' bonus tolerance is gained?", options: ["0.2mm", "0.1mm", "0.0mm", "0.05mm"], answer: 2 },
                { question: "What is a primary consideration when designing ribs for a plastic part to avoid sink marks?", options: ["The rib thickness should be no more than 50-60% of the nominal wall thickness.", "The ribs should be as thick as possible to add strength.", "The ribs should be hollow.", "The ribs must be perpendicular to the mold's parting line."], answer: 0 },
                { question: "What does the 'K-Factor' in a sheet metal part's properties represent?", options: ["The material's tensile strength.", "The location of the neutral axis within the material thickness, used for accurate flat pattern calculations.", "The cost of the raw material per kilogram.", "The number of bends allowed in the part."], answer: 1 },
                { question: "A kinematic simulation of a robotic arm is needed to check for collisions and reach. What type of analysis is most appropriate?", options: ["Static Stress Analysis", "Modal Analysis", "Multi-Body Dynamics Analysis", "Thermal Analysis"], answer: 2 },
                { question: "What is the primary DFM concern when a design includes an 'undercut' feature on an injection-molded part?", options: ["It weakens the part significantly.", "It requires a more complex and expensive mold with side-actions or sliders to be ableto eject the part.", "It is impossible to create with injection molding.", "It causes the part to be a different color in that area."], answer: 1 },
                { question: "In a large assembly, if performance is slow, what is a common strategy to improve it?", options: ["Increase the graphical quality settings.", "Set non-critical components to a 'lightweight' or 'simplified' representation.", "Add more color and appearances to the parts.", "Continuously rotate the model to keep the graphics card active."], answer: 1 },
                { question: "What does the 'tangent propagation' option typically do when creating a fillet?", options: ["It makes the fillet tangent to the screen view.", "It extends the fillet along all connected edges that are tangent to the selected edge.", "It changes the fillet to a chamfer.", "It ensures the fillet is G2 continuous."], answer: 1 }
            ];
            
            let currentQuestionIndex = 0;
            let score = 0;
            let timerInterval;
            let userData = {};
            let userAnswers = [];
            
            // --- FUNCTIONS ---
            
            document.addEventListener('contextmenu', event => event.preventDefault());

            function getFinalQuestions() {
                const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
                return shuffled.slice(0, 15);
            }
            
            function generateCertificateNumber() {
                const timestamp = Date.now();
                const randomPart = Math.random().toString(36).substr(2, 5).toUpperCase();
                return `CAD-${timestamp}-${randomPart}`;
            }

            function transitionToStep(from, to) {
                from.classList.add('fade-out');
                setTimeout(() => {
                    from.classList.add('hidden');
                    from.classList.remove('fade-out');
                    to.classList.remove('hidden');
                    to.classList.add('fade-in');
                    to.classList.remove('fade-out'); // Ensure fade-in is not overridden
                }, 300);
            }

            function validateForm() {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const phoneRegex = /^[6-9]\d{9}$/;

                if (!fullNameInput.value || !emailInput.value || !phoneInput.value || !collegeNameInput.value || !semesterInput.value || !streamInput.value) {
                    errorMessageEl.textContent = "Please fill out all fields.";
                    errorContainer.classList.remove('hidden');
                    return false;
                }
                if (!emailRegex.test(emailInput.value)) {
                    errorMessageEl.textContent = "Please enter a valid email address.";
                    errorContainer.classList.remove('hidden');
                    return false;
                }
                 if (!phoneRegex.test(phoneInput.value)) {
                    errorMessageEl.textContent = "Please enter a valid 10-digit Indian phone number.";
                    errorContainer.classList.remove('hidden');
                    return false;
                }
                errorContainer.classList.add('hidden');
                return true;
            }

            function showInstructions() {
                 if (!validateForm()) return;
                
                userData = { 
                    name: fullNameInput.value, email: emailInput.value, phone: phoneInput.value, 
                    college: collegeNameInput.value, year: semesterInput.value, stream: streamInput.value,
                    certificateNumber: generateCertificateNumber() 
                };

                transitionToStep(step1, stepInstructions);
            }

            function startQuiz() {
                quizQuestions = getFinalQuestions();

                progressBarContainer.classList.remove('hidden');
                const progress = ((currentQuestionIndex) / quizQuestions.length) * 100;
                progressBar.style.width = `${progress}%`;
                
                transitionToStep(stepInstructions, step2);
                loadQuestion();
            }

            function loadQuestion() {
                quizContainer.classList.remove('fade-out');
                quizContainer.classList.add('fade-in');
                clearInterval(timerInterval);
                resetAnswerStyles();

                if (currentQuestionIndex < quizQuestions.length) {
                    const question = quizQuestions[currentQuestionIndex];
                    questionNumberEl.textContent = `${currentQuestionIndex + 1}`;
                    questionTextEl.textContent = question.question;
                    answerOptionsEl.innerHTML = '';
                    question.options.forEach((option, index) => {
                        const button = document.createElement('button');
                        button.textContent = option;
                        button.classList.add('answer-option', 'w-full', 'p-4', 'bg-gray-50', 'rounded-lg', 'text-left', 'hover:bg-gray-100');
                        button.dataset.index = index;
                        button.addEventListener('click', () => selectAnswer(button));
                        answerOptionsEl.appendChild(button);
                    });
                    nextQuestionBtn.textContent = currentQuestionIndex === quizQuestions.length - 1 ? 'Finish Test' : 'Next';
                    startTimer();
                }
            }
            
            function startTimer() {
                let timeLeft = 40;
                timerEl.textContent = `00:${timeLeft.toString().padStart(2, '0')}`;
                timerEl.classList.remove('text-red-500');
                timerInterval = setInterval(() => {
                    timeLeft--;
                    timerEl.textContent = `00:${String(timeLeft).padStart(2, '0')}`;
                    if (timeLeft < 10) timerEl.classList.add('text-red-500');
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        handleNextQuestion(false);
                    }
                }, 1000);
            }

            function selectAnswer(button) {
                resetAnswerStyles();
                button.classList.add('selected');
            }
            
            function resetAnswerStyles() {
                 document.querySelectorAll('.answer-option').forEach(btn => btn.classList.remove('selected'));
            }

            function handleNextQuestion(answered = true) {
                clearInterval(timerInterval);
                const selectedOption = document.querySelector('.answer-option.selected');
                let selectedAnswerIndex = -1; 

                if (answered && selectedOption) {
                    selectedAnswerIndex = parseInt(selectedOption.dataset.index);
                    if (selectedAnswerIndex === quizQuestions[currentQuestionIndex].answer) score++;
                }
                userAnswers.push(selectedAnswerIndex);
                
                currentQuestionIndex++;
                
                quizContainer.classList.add('fade-out');
                setTimeout(() => {
                    if (currentQuestionIndex < quizQuestions.length) {
                        const progress = ((currentQuestionIndex) / quizQuestions.length) * 100;
                        progressBar.style.width = `${progress}%`;
                        loadQuestion();
                    }
                    else {
                        progressBar.style.width = '100%';
                        transitionToStep(step2, step3);
                        showResults();
                    }
                }, 300);
            }

            function showResults() {
                finalScoreEl.textContent = `${score}/${quizQuestions.length}`;
                
                const percentage = (score / quizQuestions.length) * 100;
                if (percentage > 85) {
                    placementMessageEl.textContent = "Congratulations! You are eligible to sit for placements.";
                    placementMessageEl.classList.add('text-green-600');
                } else {
                    placementMessageEl.textContent = "Thank you for taking the test. We encourage you to keep learning.";
                    placementMessageEl.classList.add('text-gray-600');
                }
                
                sendDataToBackend();
                populateFullReview();
            }
            
            function populateFullReview() {
                reviewSection.classList.remove('hidden');
                fullReviewList.innerHTML = '';
                quizQuestions.forEach((question, index) => {
                    const userAnswerIndex = userAnswers[index];
                    const correctAnswerIndex = question.answer;
                    const isCorrect = userAnswerIndex === correctAnswerIndex;
                    
                    let userAnswerText = (userAnswerIndex === -1) ? '<span class="font-semibold text-gray-600">Not Answered</span>' : question.options[userAnswerIndex];
                    let correctAnswerText = question.options[correctAnswerIndex];

                    const reviewItem = document.createElement('div');
                    reviewItem.className = `p-4 border rounded-lg ${isCorrect ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200'}`;
                    reviewItem.innerHTML = `<p class="font-semibold text-gray-800">${index + 1}. ${question.question}</p><p class="text-sm mt-2">Your Answer: <span class="${isCorrect ? 'text-green-700 font-bold' : 'text-red-700 font-bold'}">${userAnswerText}</span></p>${!isCorrect ? `<p class="text-sm mt-1">Correct Answer: <span class="text-green-700 font-bold">${correctAnswerText}</span></p>` : ''}`;
                    fullReviewList.appendChild(reviewItem);
                });
            }

            function sendDataToBackend() {
                const finalData = { ...userData, score: `${score}/${quizQuestions.length}` };
                fetch(googleSheetWebAppUrl, { method: 'POST', mode: 'no-cors', cache: 'no-cache', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(finalData) })
                  .then(() => console.log("Data sent successfully to Google Sheets."))
                  .catch(err => console.error("Error sending data:", err));
            }
            
            async function generateCertificate() {
                document.getElementById('cert-name').textContent = userData.name;
                document.getElementById('cert-score').textContent = `${score}/${quizQuestions.length}`;
                document.getElementById('cert-date').textContent = new Date().toLocaleDateString('en-GB');
                document.getElementById('cert-number').textContent = `Certificate No: ${userData.certificateNumber}`;
                const certificateElement = document.getElementById('certificate-template');
                certificateElement.classList.remove('hidden');

                const canvas = await html2canvas(certificateElement.firstElementChild, { scale: 3 });
                const imgData = canvas.toDataURL('image/png');
                
                certificateElement.classList.add('hidden');

                window.jsPDF = window.jspdf.jsPDF;
                const pdf = new jsPDF({ orientation: 'landscape', unit: 'px', format: [800, 565] });
                pdf.addImage(imgData, 'PNG', 0, 0, 800, 565);
                pdf.save(`Certificate-${userData.name.replace(/ /g, '_')}.pdf`);
            }
            
            // --- Certificate Validator Functions ---
            function openValidator() {
                validatorModal.classList.remove('hidden');
            }

            function closeValidator() {
                validatorModal.classList.add('hidden');
                certIdInput.value = '';
                validatorResultEl.innerHTML = '';
                validatorResultEl.classList.add('hidden');
            }

            async function validateCertificate() {
                const certId = certIdInput.value.trim();
                if (!certId) {
                    validatorResultEl.innerHTML = `<p class="text-red-700 font-bold p-2">Please enter a Certificate Number.</p>`;
                    validatorResultEl.classList.remove('hidden', 'bg-green-100');
                    validatorResultEl.classList.add('bg-red-100');
                    return;
                }

                validateCertBtn.innerHTML = `<span class="spinner"></span> Validating...`;
                validateCertBtn.disabled = true;

                try {
                    const response = await fetch(`${googleSheetWebAppUrl}?certId=${encodeURIComponent(certId)}`);
                    const result = await response.json();
                    
                    validatorResultEl.classList.remove('hidden');
                    if (result.found) {
                        const issueDate = new Date(result.timestamp).toLocaleDateString('en-GB');
                        validatorResultEl.classList.remove('bg-red-100');
                        validatorResultEl.classList.add('bg-green-100');
                        validatorResultEl.innerHTML = `
                            <div class="flex items-center text-green-800">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-patch-check-fill mr-3 flex-shrink-0" viewBox="0 0 16 16"><path d="M10.067.87a2.89 2.89 0 0 0-4.134 0l-.622.638-.89-.011a2.89 2.89 0 0 0-2.924 2.924l.01.89-.636.622a2.89 2.89 0 0 0 0 4.134l.637.622-.011.89a2.89 2.89 0 0 0 2.924 2.924l.89-.01.622.636a2.89 2.89 0 0 0 4.134 0l.622-.637.89.011a2.89 2.89 0 0 0 2.924-2.924l-.01-.89.636-.622a2.89 2.89 0 0 0 0-4.134l-.637-.622.011-.89a2.89 2.89 0 0 0-2.924-2.924l-.89.01-.622-.636zm.287 5.984-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7 8.793l2.646-2.647a.5.5 0 0 1 .708.708z"/></svg>
                                <div>
                                    <p class="font-bold">Certificate Valid</p>
                                    <p class="text-sm">Issued to: <strong class="font-semibold">${result.name}</strong></p>
                                    <p class="text-sm">College: <strong class="font-semibold">${result.college}</strong></p>
                                    <p class="text-sm">Score: <strong class="font-semibold">${result.score}</strong> on ${issueDate}</p>
                                </div>
                            </div>
                        `;
                    } else {
                        validatorResultEl.classList.remove('bg-green-100');
                        validatorResultEl.classList.add('bg-red-100');
                        validatorResultEl.innerHTML = `<p class="text-red-700 font-bold p-2">Certificate Not Found or Invalid.</p>`;
                    }
                } catch (error) {
                    console.error("Validation error:", error);
                    validatorResultEl.classList.remove('hidden', 'bg-green-100');
                    validatorResultEl.classList.add('bg-red-100');
                    validatorResultEl.innerHTML = `<p class="text-red-700 font-bold p-2">An error occurred during validation. Please try again.</p>`;
                } finally {
                    validateCertBtn.innerHTML = `Validate`;
                    validateCertBtn.disabled = false;
                }
            }

            // --- EVENT LISTENERS ---
            showInstructionsBtn.addEventListener('click', showInstructions);
            startQuizBtn.addEventListener('click', startQuiz);
            nextQuestionBtn.addEventListener('click', () => handleNextQuestion(true));
            downloadCertBtn.addEventListener('click', generateCertificate);
            openValidatorBtn.addEventListener('click', openValidator);
            closeValidatorBtn.addEventListener('click', closeValidator);
            validateCertBtn.addEventListener('click', validateCertificate);

        });
    </script>

</body>
</html>
